name: Deploy Infrastructure

on:
  push:
    branches: [main]
  paths:
    - 'infrastructure.yml'
    - '.github\workflows\infrastructure.yml'
    - '.github\workflows\ecr-repository.yml'

env:
  AWS_REGISTRY_URI: ${{ secrets.AWS_ACCOUNT_ID }}.dkr.ecr.us-east-1.amazonaws.com
  AWS_REGION: us-east-1
  AWS_ROLE_TO_ASSUME: arn:aws:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/code-runner-pipeline-role

jobs:
  upsert-ecr-repository:
    runs-on: ubuntu-latest
    uses: ./.github/workflows/ecr-repository.yml
